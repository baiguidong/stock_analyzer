# Aè‚¡æ•°æ®åˆ†æå¹³å° - å¿«é€Ÿå¼€å§‹æŒ‡å—

## âœ… å·²å®ŒæˆåŠŸèƒ½

æœ¬æ¬¡å‡çº§å·²å®Œæˆä»¥ä¸‹æ‰€æœ‰åŠŸèƒ½ï¼š

### 1. æ•°æ®æºåˆ‡æ¢ (akshare â†’ tushare)
- âœ… ä½¿ç”¨tushareè·å–è‚¡ç¥¨æ•°æ®
- âœ… æ”¯æŒè·å–åŸºç¡€æŒ‡æ ‡ï¼šå‡€èµ„äº§ã€å¸‚ç›ˆç‡ã€å¸‚å‡€ç‡ã€æ¢æ‰‹ç‡ç­‰
- âœ… CLIæ–¹å¼è·å–æ•°æ®

### 2. ç”¨æˆ·ç³»ç»Ÿ
- âœ… ç”¨æˆ·æ³¨å†Œ/ç™»å½•
- âœ… JWTè®¤è¯
- âœ… ç™»å½•çŠ¶æ€æŒä¹…åŒ–

### 3. è‡ªé€‰è‚¡ç¥¨åŠŸèƒ½
- âœ… æ·»åŠ /åˆ é™¤è‡ªé€‰è‚¡ç¥¨
- âœ… æŸ¥çœ‹è‡ªé€‰åˆ—è¡¨ï¼ˆç‹¬ç«‹Tabé¡µï¼‰
- âœ… æ‰‹åŠ¨æ›´æ–°è‡ªé€‰è‚¡ç¥¨å†å²æ•°æ®
- âœ… æŒ‰ç”¨æˆ·éš”ç¦»æ•°æ®

### 4. å®šæ—¶ä»»åŠ¡
- âœ… æ¯æ—¥æ—©ä¸Š7ç‚¹è‡ªåŠ¨æ›´æ–°è‡ªé€‰è‚¡ç¥¨å†å²æ•°æ®
- âœ… ä»…æ›´æ–°ç”¨æˆ·æ·»åŠ çš„è‡ªé€‰è‚¡ç¥¨

### 5. Webç•Œé¢
- âœ… ç™»å½•åç›´æ¥å±•ç¤º"Aè‚¡åˆ†æå¹³å°"Tabï¼ˆæ— èƒŒæ™¯é¡µï¼‰
- âœ… 4ä¸ªTabé¡µé¢ï¼šAè‚¡åˆ†æå¹³å°ã€æˆ‘çš„è‡ªé€‰ã€è‚¡ç¥¨è¯¦æƒ…ã€AIå¯¹è¯
- âœ… å“åº”å¼è®¾è®¡

---

## ğŸš€ å®‰è£…å’Œå¯åŠ¨

### 1. å®‰è£…ä¾èµ–
```bash
pip install -r requirements.txt
```

### 2. é…ç½®
```bash
# å¤åˆ¶é…ç½®æ–‡ä»¶
cp config.yaml.example config.yaml

# ç¼–è¾‘config.yamlï¼Œè®¾ç½®ä»¥ä¸‹å¿…å¡«é¡¹ï¼š
# - tushare.token: ä» https://tushare.pro/user/token è·å–
# - jwt.secret_key: ä¿®æ”¹ä¸ºéšæœºå­—ç¬¦ä¸²ï¼ˆç”Ÿäº§ç¯å¢ƒå¿…æ”¹ï¼‰
```

**tushare tokenè·å–**:
1. è®¿é—® https://tushare.pro/register æ³¨å†Œè´¦å·
2. è¿›å…¥"ä¸ªäººä¸­å¿ƒ" -> "æ¥å£TOKEN"
3. å¤åˆ¶tokenåˆ°config.yaml

### 3. å¯åŠ¨æœåŠ¡
```bash
python cli.py server --host 0.0.0.0 --port 8000
```

### 4. è®¿é—®Webç•Œé¢
æ‰“å¼€æµè§ˆå™¨è®¿é—®: **http://localhost:8000**

---

## ğŸ“– ä½¿ç”¨è¯´æ˜

### æ³¨å†Œå’Œç™»å½•
1. é¦–æ¬¡ä½¿ç”¨ç‚¹å‡»å³ä¸Šè§’"æ³¨å†Œ"
2. å¡«å†™ç”¨æˆ·åã€é‚®ç®±ã€å¯†ç 
3. æ³¨å†ŒæˆåŠŸåä½¿ç”¨ç”¨æˆ·åå’Œå¯†ç ç™»å½•

### æµè§ˆè‚¡ç¥¨
1. ç‚¹å‡»"Aè‚¡åˆ†æå¹³å°"Tab
2. ä½¿ç”¨ç­›é€‰æ¡ä»¶æŸ¥æ‰¾è‚¡ç¥¨
3. ç‚¹å‡»è‚¡ç¥¨ä»£ç æŸ¥çœ‹è¯¦æƒ…

### ç®¡ç†è‡ªé€‰
1. åœ¨è‚¡ç¥¨åˆ—è¡¨ä¸­ç‚¹å‡»"åŠ è‡ªé€‰"æŒ‰é’®
2. åˆ‡æ¢åˆ°"æˆ‘çš„è‡ªé€‰"TabæŸ¥çœ‹
3. ç‚¹å‡»"æ›´æ–°æ•°æ®"æŒ‰é’®æ‰‹åŠ¨æ›´æ–°å†å²æ•°æ®
4. ç³»ç»Ÿæ¯å¤©æ—©ä¸Š7ç‚¹è‡ªåŠ¨æ›´æ–°

### AIå¯¹è¯
1. åˆ‡æ¢åˆ°"AIå¯¹è¯"Tab
2. è¾“å…¥é—®é¢˜ï¼ˆå¦‚"æŸ¥è¯¢å¹³å®‰é“¶è¡Œçš„ä¿¡æ¯"ï¼‰
3. AIä¼šè°ƒç”¨å·¥å…·æŸ¥è¯¢æ•°æ®åº“å¹¶å›å¤
4. æ”¯æŒå¤æ‚SQLæŸ¥è¯¢ï¼ˆå¦‚"ç”¨SQLæŸ¥è¯¢å¸‚ç›ˆç‡ä½äº15çš„æ‰€æœ‰é“¶è¡Œè‚¡"ï¼‰

**AIæ”¯æŒçš„æŸ¥è¯¢ç±»å‹**ï¼š
- è‚¡ç¥¨æœç´¢å’Œè¯¦æƒ…æŸ¥è¯¢
- å†å²æ•°æ®å’ŒKçº¿åˆ†æ
- æ¡ä»¶ç­›é€‰ï¼ˆå¸‚ç›ˆç‡ã€å¸‚å‡€ç‡ã€è¡Œä¸šç­‰ï¼‰
- è‡ªå®šä¹‰SQLæŸ¥è¯¢ï¼ˆä»…æ”¯æŒSELECTï¼‰
- æ•°æ®åº“ç»Ÿè®¡ä¿¡æ¯

**SQLæŸ¥è¯¢ç¤ºä¾‹**ï¼š
- "ç”¨SQLæŸ¥è¯¢å¸‚ç›ˆç‡æœ€ä½çš„10åªè‚¡ç¥¨"
- "æŸ¥è¯¢600000è¿™åªè‚¡ç¥¨æœ€è¿‘30å¤©çš„æ¶¨è·Œå¹…"
- "ç”¨SQLç»Ÿè®¡å„è¡Œä¸šçš„å¹³å‡å¸‚ç›ˆç‡"

---

## ğŸ”§ é…ç½®è¯´æ˜

### config.yaml ä¸»è¦é…ç½®

```yaml
# Tushareé…ç½®
tushare:
  token: "your-token-here"  # å¿…å¡«

# JWTé…ç½®
jwt:
  secret_key: "change-this-random-string"  # ç”Ÿäº§ç¯å¢ƒå¿…æ”¹
  access_token_expire_minutes: 1440  # Tokenæœ‰æ•ˆæœŸ

# å®šæ—¶ä»»åŠ¡
update_schedule:
  daily_update_time: "07:00"  # æ¯å¤©7ç‚¹æ›´æ–°
  auto_update: true

# æ•°æ®åº“
database:
  url: "sqlite:///./stock_data.db"  # é»˜è®¤SQLite
```

---

## ğŸ“Š æ•°æ®åº“è¡¨ç»“æ„

### users - ç”¨æˆ·è¡¨
| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | Integer | ä¸»é”® |
| username | String(50) | ç”¨æˆ·åï¼ˆå”¯ä¸€ï¼‰ |
| email | String(100) | é‚®ç®±ï¼ˆå”¯ä¸€ï¼‰ |
| hashed_password | String(255) | å¯†ç å“ˆå¸Œ |
| is_active | Boolean | æ˜¯å¦æ¿€æ´» |
| created_at | DateTime | åˆ›å»ºæ—¶é—´ |

### favorites - è‡ªé€‰è‚¡ç¥¨è¡¨
| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | Integer | ä¸»é”® |
| user_id | Integer | ç”¨æˆ·IDï¼ˆå¤–é”®ï¼‰ |
| stock_code | String(10) | è‚¡ç¥¨ä»£ç  |
| added_at | DateTime | æ·»åŠ æ—¶é—´ |

### stocks - è‚¡ç¥¨åŸºæœ¬ä¿¡æ¯è¡¨
| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| code | String(10) | è‚¡ç¥¨ä»£ç ï¼ˆä¸»é”®ï¼‰ |
| name | String(50) | è‚¡ç¥¨åç§° |
| pe_ratio | Float | å¸‚ç›ˆç‡ï¼ˆåŠ¨æ€ï¼‰ |
| pb_ratio | Float | å¸‚å‡€ç‡ |
| net_assets | Float | å‡€èµ„äº§ï¼ˆäº¿å…ƒï¼‰ |
| turnover_rate | Float | æ¢æ‰‹ç‡(%) |
| ...æ›´å¤šå­—æ®µ | | |

---

## ğŸŒ APIç«¯ç‚¹

### è®¤è¯ç›¸å…³
- `POST /api/auth/register` - ç”¨æˆ·æ³¨å†Œ
- `POST /api/auth/login` - ç”¨æˆ·ç™»å½•
- `GET /api/auth/me` - è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯

### è‡ªé€‰è‚¡ç¥¨
- `POST /api/favorites` - æ·»åŠ è‡ªé€‰
- `DELETE /api/favorites/{code}` - åˆ é™¤è‡ªé€‰
- `GET /api/favorites` - è·å–è‡ªé€‰åˆ—è¡¨
- `POST /api/favorites/update` - æ›´æ–°è‡ªé€‰æ•°æ®

### è‚¡ç¥¨æ•°æ®
- `GET /api/stocks/search` - æœç´¢è‚¡ç¥¨
- `POST /api/stocks/list` - è·å–è‚¡ç¥¨åˆ—è¡¨
- `GET /api/stocks/{code}` - è·å–è‚¡ç¥¨è¯¦æƒ…
- `GET /api/stocks/{code}/kline` - è·å–Kçº¿æ•°ï¿½ï¿½ï¿½

### å…¶ä»–
- `GET /api/stats` - è·å–ç»Ÿè®¡ä¿¡æ¯
- `POST /api/chat` - AIå¯¹è¯ï¼ˆæ”¯æŒFunction Callingï¼‰
- `GET /api/tools` - è·å–å¯ç”¨çš„LLMå·¥å…·å®šä¹‰

**AIå·¥å…·åˆ—è¡¨**ï¼š
- `search_stock` - æœç´¢è‚¡ç¥¨
- `get_stock_detail` - è·å–è‚¡ç¥¨è¯¦æƒ…
- `get_stock_history` - è·å–å†å²æ•°æ®
- `filter_stocks` - æ¡ä»¶ç­›é€‰è‚¡ç¥¨
- `execute_sql_query` - æ‰§è¡Œè‡ªå®šä¹‰SQLæŸ¥è¯¢ï¼ˆä»…SELECTï¼‰
- `get_database_stats` - è·å–æ•°æ®åº“ç»Ÿè®¡

å®Œæ•´APIæ–‡æ¡£: http://localhost:8000/docs

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. Tushareç§¯åˆ†
- å…è´¹ç”¨æˆ·æœ‰æ¯æ—¥è°ƒç”¨æ¬¡æ•°é™åˆ¶
- éƒ¨åˆ†æ¥å£éœ€è¦ç§¯åˆ†ï¼ˆå¯é€šè¿‡ç­¾åˆ°è·å–ï¼‰
- è¯¦è§ï¼šhttps://tushare.pro/document/1?doc_id=13

### 2. æ•°æ®æ›´æ–°
- é¦–æ¬¡å¯åŠ¨éœ€è¦æ‰‹åŠ¨è·å–è‚¡ç¥¨åˆ—è¡¨æ•°æ®
- è¿è¡Œ `python cli.py update all` è·å–åŸºç¡€æ•°æ®
- å®šæ—¶ä»»åŠ¡ä»…æ›´æ–°ç”¨æˆ·è‡ªé€‰è‚¡ç¥¨

### 3. å®‰å…¨å»ºè®®
- ç”Ÿäº§ç¯å¢ƒä¿®æ”¹JWTå¯†é’¥
- ä½¿ç”¨HTTPS
- å®šæœŸå¤‡ä»½æ•°æ®åº“
- è®¾ç½®å¼ºå¯†ç ç­–ç•¥

---

## ğŸ› å¸¸è§é—®é¢˜

**Q: ç™»å½•ååˆ·æ–°é¡µé¢éœ€è¦é‡æ–°ç™»å½•ï¼Ÿ**
A: æ£€æŸ¥æµè§ˆå™¨LocalStorageæ˜¯å¦è¢«æ¸…ç©ºã€‚Tokené»˜è®¤æœ‰æ•ˆæœŸ24å°æ—¶ã€‚

**Q: Tushareè¿”å›é”™è¯¯"ç§¯åˆ†ä¸è¶³"ï¼Ÿ**
A: æŸäº›é«˜çº§æ¥å£éœ€è¦ç§¯åˆ†ï¼Œå»ºè®®æ¯æ—¥ç­¾åˆ°è·å–ç§¯åˆ†ã€‚

**Q: å®šæ—¶ä»»åŠ¡æ²¡æœ‰æ‰§è¡Œï¼Ÿ**
A: æ£€æŸ¥config.yamlä¸­`auto_update: true`ï¼Œç¡®ä¿æœåŠ¡æŒç»­è¿è¡Œã€‚

**Q: æ•°æ®åº“åœ¨å“ªé‡Œï¼Ÿ**
A: é»˜è®¤åœ¨é¡¹ç›®æ ¹ç›®å½•çš„`stock_data.db`æ–‡ä»¶ã€‚

**Q: å¦‚ä½•æ·»åŠ ç®¡ç†å‘˜ç”¨æˆ·ï¼Ÿ**
A: ç›´æ¥ä¿®æ”¹æ•°æ®åº“usersè¡¨ï¼Œè®¾ç½®`is_admin=1`ã€‚

---

## ğŸ“ å‘½ä»¤è¡Œå·¥å…·

```bash
# å¯åŠ¨æœåŠ¡
python cli.py server

# æ›´æ–°æ‰€æœ‰è‚¡ç¥¨åŸºç¡€ä¿¡æ¯
python cli.py update all

# æ›´æ–°æŒ‡å®šè‚¡ç¥¨å†å²æ•°æ®
python cli.py update daily --codes 000001,600000

# æŸ¥çœ‹ç»Ÿè®¡ä¿¡æ¯
python cli.py stats

# æœç´¢è‚¡ç¥¨
python cli.py search å¹³å®‰
```

---

## ğŸ“‚ é¡¹ç›®ç»“æ„

```
/data/stock/
â”œâ”€â”€ cli.py                      # CLIå…¥å£
â”œâ”€â”€ config.yaml.example         # é…ç½®æ¨¡æ¿
â”œâ”€â”€ requirements.txt            # ä¾èµ–åˆ—è¡¨
â”œâ”€â”€ IMPLEMENTATION_SUMMARY.md   # è¯¦ç»†å®ç°æ–‡æ¡£
â”œâ”€â”€ README_USAGE.md            # æœ¬æ–‡ä»¶
â”‚
â””â”€â”€ stock_analyzer/
    â”œâ”€â”€ models/                 # æ•°æ®æ¨¡å‹
    â”‚   â””â”€â”€ stock.py           # Stock, User, Favorite
    â”œâ”€â”€ services/              # ä¸šåŠ¡é€»è¾‘
    â”‚   â”œâ”€â”€ data_fetcher.py    # Tushareæ•°æ®è·å–
    â”‚   â”œâ”€â”€ database.py        # æ•°æ®åº“æœåŠ¡
    â”‚   â””â”€â”€ scheduler.py       # å®šæ—¶ä»»åŠ¡
    â”œâ”€â”€ api/                   # APIæ¥å£
    â”‚   â”œâ”€â”€ server.py          # FastAPIæœåŠ¡
    â”‚   â””â”€â”€ auth.py            # JWTè®¤è¯
    â”œâ”€â”€ tools/                 # LLMå·¥å…·
    â”‚   â””â”€â”€ stock_tools.py     # Function Calling
    â””â”€â”€ web/                   # å‰ç«¯
        â”œâ”€â”€ index.html         # é¡µé¢
        â””â”€â”€ app.js             # JSé€»è¾‘
```

---

## ğŸ‰ å®Œæˆæƒ…å†µ

- âœ… æ•°æ®æºåˆ‡æ¢åˆ°tushare
- âœ… ç”¨æˆ·ç™»å½•æ³¨å†Œç³»ç»Ÿ
- âœ… è‡ªé€‰è‚¡ç¥¨åŠŸèƒ½
- âœ… Webç•Œé¢é›†æˆ
- âœ… å®šæ—¶ä»»åŠ¡ä¼˜åŒ–
- âœ… å‰ç«¯ç™»å½•ç•Œé¢
- âœ… æˆ‘çš„è‡ªé€‰Tabé¡µé¢
- âœ… LLM SQLæŸ¥è¯¢å¢å¼º

**è¿›åº¦**: 100% å®Œæˆ

---

åˆ›å»ºæ—¶é—´: 2025-11-07
æœ€åæ›´æ–°: 2025-11-07
ç‰ˆæœ¬: v2.0
ä½œè€…: Claude Code
