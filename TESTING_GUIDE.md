# Web界面功能测试指南

## 🧪 快速测试步骤

### 前置条件

1. 确保已安装所有依赖
2. 已配置 config.yaml
3. 数据库中有股票数据（如果没有，运行 `python cli.py update all`）

### 启动测试

```bash
# 1. 启动服务端
python cli.py server

# 服务启动成功后会显示：
# INFO:     Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)

# 2. 打开Web界面
# 在浏览器中打开: stock_analyzer/web/index.html
```

## 📋 功能测试清单

### ✅ 标签1: AI对话

**测试项目:**
- [ ] 页面加载正常，显示欢迎消息
- [ ] 顶部统计信息正确显示（股票数、记录数、日期）
- [ ] 示例问题按钮可点击
- [ ] 输入框可以输入文字
- [ ] 点击"发送"按钮或按Enter键发送消息
- [ ] 收到AI回复
- [ ] 对话历史正确显示

**测试用例:**
```
1. 点击"查询平安银行"按钮
   预期: AI返回平安银行的详细信息

2. 输入: "帮我找市盈率低于10的股票"
   预期: AI调用工具查询并返回结果

3. 输入: "数据库有多少只股票？"
   预期: AI返回统计信息
```

### ✅ 标签2: 股票列表

**测试项目:**
- [ ] 切换到"股票列表"标签
- [ ] 行业下拉框自动加载
- [ ] 默认显示股票列表
- [ ] 分页信息正确显示

**过滤功能测试:**
```
1. 关键词搜索
   输入: "平安"
   点击: 查询
   预期: 显示包含"平安"的股票

2. 行业筛选
   选择: "银行"
   点击: 查询
   预期: 只显示银行行业股票

3. 市盈率范围
   最小: 5
   最大: 15
   点击: 查询
   预期: 显示市盈率在5-15之间的股票

4. 市值范围
   最小: 100
   点击: 查询
   预期: 显示市值大于100亿的股票

5. 组合过滤
   关键词: "中国"
   行业: "银行"
   市盈率: 3-10
   点击: 查询
   预期: 显示满足所有条件的股票
```

**排序功能测试:**
```
1. 按市盈率排序
   选择排序字段: 市盈率
   选择排序方式: 升序
   点击: 查询
   预期: 列表按市盈率从小到大排列

2. 按市值排序
   选择排序字段: 市值
   选择排序方式: 降序
   点击: 查询
   预期: 列表按市值从大到小排列
```

**分页功能测试:**
- [ ] 点击"下一页"按钮，显示第2页
- [ ] 点击"上一页"按钮，返回第1页
- [ ] 第1页时"上一页"按钮禁用
- [ ] 最后一页时"下一页"按钮禁用
- [ ] 页码信息正确显示

**交互功能测试:**
- [ ] 鼠标悬停在表格行上显示高亮
- [ ] 点击股票代码跳转到详情页
- [ ] 点击"重置"按钮清空所有过滤条件

### ✅ 标签3: 股票详情

**测试项目:**
- [ ] 切换到"股票详情"标签
- [ ] 显示提示信息

**查询功能测试:**
```
1. 输入存在的股票代码
   输入: 000001
   点击: 查询
   预期: 显示股票详情

2. 输入不存在的股票代码
   输入: 999999
   点击: 查询
   预期: 显示"未找到股票"错误信息

3. 从列表页跳转
   操作: 在列表页点击任意股票代码
   预期: 自动切换到详情页并显示该股票信息
```

**详情展示测试:**
- [ ] 股票名称和代码正确显示
- [ ] 更新时间显示
- [ ] 10个财务指标卡片全部显示
- [ ] 指标数值格式正确（保留2位小数）
- [ ] K线图正确渲染
- [ ] 成交量图正确渲染

**K线图交互测试:**
- [ ] 鼠标悬停显示详细数据（日期、开盘、收盘、最低、最高）
- [ ] 鼠标滚轮缩放图表
- [ ] 鼠标拖动查看不同时间段
- [ ] 底部滑块控制显示范围
- [ ] 红色蜡烛代表上涨，绿色代表下跌

**成交量图交互测试:**
- [ ] 成交量柱状图显示正确
- [ ] 与K线图联动缩放
- [ ] 鼠标悬停显示成交量数值

**响应式测试:**
- [ ] 调整浏览器窗口大小，图表自动调整
- [ ] 信息卡片网格自适应布局

## 🐛 常见问题排查

### 问题1: 页面无法加载数据

**检查项:**
```bash
# 1. 确认服务端正在运行
curl http://localhost:8000/api/stats

# 2. 检查浏览器控制台错误
# 按F12打开开发者工具，查看Console标签

# 3. 检查网络请求
# 在Network标签中查看API请求是否成功
```

### 问题2: K线图不显示

**可能原因:**
- ECharts库未加载
- 股票没有历史数据
- 浏览器不支持

**解决方法:**
```bash
# 1. 检查数据库中是否有历史数据
python cli.py stats

# 2. 更新历史数据
python cli.py update daily

# 3. 检查浏览器控制台错误信息
```

### 问题3: AI对话无响应

**可能原因:**
- LLM API key未配置或无效
- API调用超时
- 网络连接问题

**解决方法:**
```bash
# 1. 检查配置文件
cat config.yaml

# 2. 查看服务端日志
# 服务端终端会显示错误信息

# 3. 测试API连接
curl -X POST http://localhost:8000/api/chat \
  -H "Content-Type: application/json" \
  -d '{"messages":[{"role":"user","content":"测试"}]}'
```

### 问题4: 股票列表为空

**可能原因:**
- 数据库中没有数据
- 过滤条件过于严格

**解决方法:**
```bash
# 1. 检查数据库
python cli.py stats

# 2. 更新数据
python cli.py update all

# 3. 重置过滤条件
# 点击"重置"按钮
```

## 📊 性能测试

### 测试场景1: 大量数据加载
```
1. 不设置任何过滤条件
2. 加载第1页（50条）
预期: 1-2秒内加载完成
```

### 测试场景2: 复杂查询
```
1. 设置多个过滤条件
2. 执行查询
预期: 2-3秒内返回结果
```

### 测试场景3: K线图渲染
```
1. 查询股票详情
2. 加载90天K线数据
预期: 3-5秒内渲染完成
```

## ✅ 完整测试报告模板

```
测试日期: ____________________
测试人员: ____________________
浏览器: ____________________

【基础功能】
□ 服务端启动正常
□ Web界面加载正常
□ 三个标签页都可切换
□ 统计信息显示正常

【AI对话】
□ 发送消息正常
□ 接收回复正常
□ 工具调用正常
□ 对话历史正常

【股票列表】
□ 列表加载正常
□ 过滤功能正常
□ 排序功能正常
□ 分页功能正常
□ 跳转功能正常

【股票详情】
□ 查询功能正常
□ 财务指标显示正常
□ K线图渲染正常
□ 成交量图渲染正常
□ 交互功能正常

【性能表现】
页面加载速度: _____ 秒
列表查询速度: _____ 秒
详情加载速度: _____ 秒
K线图渲染速度: _____ 秒

【问题记录】
1. _______________________________
2. _______________________________
3. _______________________________

【总体评价】
□ 优秀  □ 良好  □ 一般  □ 需改进

备注:
_____________________________________
_____________________________________
```

## 🎯 自动化测试（可选）

如果需要自动化测试，可以使用以下工具：

```bash
# 安装pytest和requests
pip install pytest requests

# 创建测试文件 test_api.py
# 运行测试
pytest test_api.py -v
```

## 📝 测试建议

1. **首次测试**: 按照清单逐项测试
2. **回归测试**: 更新代码后重新测试核心功能
3. **浏览器兼容性**: 在Chrome、Firefox、Safari中测试
4. **移动端测试**: 在手机浏览器中测试响应式布局
5. **性能测试**: 使用Chrome DevTools Lighthouse评分

祝测试顺利！ 🎉
